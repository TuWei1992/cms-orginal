(function(a,b){if(typeof define==="function"&&define.amd){define(["exports"],b)}else{if(typeof exports!=="undefined"){b(exports)}else{b(a)}}}(this,function(e){function d(t){var s="top-level";var y=-1;var o;var A=new j;var l=[A];var m=l[0];var r=function(D){if(D===undefined){D=1}y+=D;if(y<t.length){o=t[y]}else{o=new EOFToken}return true};var q=function(){y--;return true};var v=function(){return t[y+1]};var k=function(D){if(D===undefined){if(m.fillType!==""){s=m.fillType}else{if(m.type=="STYLESHEET"){s="top-level"}else{console.log("Unknown rule-type while switching to current rule's content mode: ",m);s=""}}}else{s=D}return true};var n=function(D){m=D;l.push(m);return true};var u=function(D){console.log("Parse error at token "+y+": "+o+".\n"+D);return true};var p=function(){var D=l.pop();m=l[l.length-1];m.append(D);return true};var B=function(){l.pop();m=l[l.length-1];return true};var w=function(){while(l.length>1){p()}};for(;;){r();if(o.tokenType==="DELIM"&&o.value==="\r"){continue}switch(s){case"top-level":switch(o.tokenType){case"CDO":case"CDC":case"WHITESPACE":break;case"AT-KEYWORD":n(new i(o.value))&&k("at-rule");break;case"{":u("Attempt to open a curly-block at top-level.")&&x();break;case"EOF":w();return A;default:n(new a)&&k("selector")&&q()}break;case"at-rule":switch(o.tokenType){case";":p()&&k();break;case"{":if(m.fillType!==""){k(m.fillType)}else{u("Attempt to open a curly-block in a statement-type at-rule.")&&B()&&k("next-block")&&q()}break;case"EOF":w();return A;default:m.appendPrelude(x())}break;case"rule":switch(o.tokenType){case"WHITESPACE":break;case"}":p()&&k();break;case"AT-KEYWORD":n(new i(o.value))&&k("at-rule");break;case"EOF":w();return A;default:n(new a)&&k("selector")&&q()}break;case"selector":switch(o.tokenType){case"{":k("declaration");break;case"EOF":B()&&w();return A;default:m.appendSelector(x())}break;case"declaration":switch(o.tokenType){case"WHITESPACE":case";":break;case"}":p()&&k();break;case"AT-RULE":n(new i(o.value))&&k("at-rule");break;case"IDENT":n(new f(o.value))&&k("after-declaration-name");break;case"EOF":w();return A;default:u()&&B()&&k("next-declaration")}break;case"after-declaration-name":switch(o.tokenType){case"WHITESPACE":break;case":":k("declaration-value");break;case";":u("Incomplete declaration - semicolon after property name.")&&B()&&k();break;case"EOF":B()&&w();return A;default:u("Invalid declaration - additional token after property name")&&B()&&k("next-declaration")}break;case"declaration-value":switch(o.tokenType){case"DELIM":if(o.value=="!"&&v().tokenType=="IDENTIFIER"&&v().value.toLowerCase()=="important"){r();m.important=true;k("declaration-end")}else{m.append(o)}break;case";":p()&&k();break;case"}":p()&&p()&&k();break;case"EOF":w();return A;default:m.append(x())}break;case"declaration-end":switch(o.tokenType){case"WHITESPACE":break;case";":p()&&k();break;case"}":p()&&p()&&k();break;case"EOF":w();return A;default:u("Invalid declaration - additional token after !important.")&&B()&&k("next-declaration")}break;case"next-block":switch(o.tokenType){case"{":x()&&k();break;case"EOF":w();return A;default:x();break}break;case"next-declaration":switch(o.tokenType){case";":k("declaration");break;case"}":k("declaration")&&q();break;case"EOF":w();return A;default:x();break}break;default:console.log("Unknown parsing mode: "+s);return}}function x(){switch(o.tokenType){case"(":case"[":case"{":return z();case"FUNCTION":return C();default:return o}}function z(){var D={"(":")","[":"]","{":"}"}[o.tokenType];var E=new c(o.tokenType);for(;;){r();switch(o.tokenType){case"EOF":case D:return E;default:E.append(x())}}}function C(){var E=new h(o.value);var D=new g();for(;;){r();switch(o.tokenType){case"EOF":case")":E.append(D);return E;case"DELIM":if(o.value==","){E.append(D);D=new g()}else{D.append(o)}break;default:D.append(x())}}}}function b(){return this}b.prototype.fillType="";b.prototype.toString=function(k){return JSON.stringify(this.toJSON(),null,k)};b.prototype.append=function(k){this.value.push(k);return this};function j(){this.value=[];return this}j.prototype=new b;j.prototype.type="STYLESHEET";j.prototype.toJSON=function(){return{type:"stylesheet",value:this.value.map(function(k){return k.toJSON()})}};function i(k){this.name=k;this.prelude=[];this.value=[];if(k in i.registry){this.fillType=i.registry[k]}return this}i.prototype=new b;i.prototype.type="AT-RULE";i.prototype.appendPrelude=function(k){this.prelude.push(k);return this};i.prototype.toJSON=function(){return{type:"at",name:this.name,prelude:this.prelude.map(function(k){return k.toJSON()}),value:this.value.map(function(k){return k.toJSON()})}};i.registry={"import":"",media:"rule","font-face":"declaration",page:"declaration",keyframes:"rule",namespace:"","counter-style":"declaration",supports:"rule",document:"rule","font-feature-values":"declaration",viewport:"","region-style":"rule"};function a(){this.selector=[];this.value=[];return this}a.prototype=new b;a.prototype.type="STYLE-RULE";a.prototype.fillType="declaration";a.prototype.appendSelector=function(k){this.selector.push(k);return this};a.prototype.toJSON=function(){return{type:"selector",selector:this.selector.map(function(k){return k.toJSON()}),value:this.value.map(function(k){return k.toJSON()})}};function f(k){this.name=k;this.value=[];return this}f.prototype=new b;f.prototype.type="DECLARATION";f.prototype.toJSON=function(){return{type:"declaration",name:this.name,value:this.value.map(function(k){return k.toJSON()})}};function c(k){this.name=k;this.value=[];return this}c.prototype=new b;c.prototype.type="BLOCK";c.prototype.toJSON=function(){return{type:"block",name:this.name,value:this.value.map(function(k){return k.toJSON()})}};function h(k){this.name=k;this.value=[];return this}h.prototype=new b;h.prototype.type="FUNCTION";h.prototype.toJSON=function(){return{type:"func",name:this.name,value:this.value.map(function(k){return k.toJSON()})}};function g(){this.value=[];return this}g.prototype=new b;g.prototype.type="FUNCTION-ARG";g.prototype.toJSON=function(){return this.value.map(function(k){return k.toJSON()})};e.parse=d}));