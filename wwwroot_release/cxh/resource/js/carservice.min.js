$().ready(function(){var a=new CarServiceIndex});var Class={create:function(){return function(){this.initialize.apply(this,arguments)}}};var controller="/carservice";var ajaxUrl={getProvince:mallBase+controller+"/provinceList.htm",getCity:mallBase+controller+"/cityListByProv.htm",queryPeccancy:mallBase+controller+"/queryPeccancy.htm",getProvinceShort:mallBase+controller+"/provinceListShort.htm",validatePeccancy:mallBase+controller+"/validatePeccancy.htm"};var CarServiceIndex=Class.create();CarServiceIndex.prototype={initialize:function(){var e=this;var a=1,c=false;$(".engineNo").hide();$("#fadongjihao").hide();$(".warn").hide();$(".frameNo").show();$("#chejiahao").show();$("#illegalSearchBtn").on("click",function(){if(e.validate()){e.searchIllegal(ajaxUrl.validatePeccancy)}return false});$("#carNo").on("blur",function(){$("#carNo").val($(this).val().toUpperCase())});$("#province").on("change",function(){$(".warn").empty();var g=$("#province").val();var h='<option value="">请选择市</option>';if(""==g||null==g){$("#city").empty().append(h);return}var i="provCode="+$("#province").val();e.getCity(ajaxUrl.getCity,function(j){e.genErrorHtml(j)},i,null,null)});$("#city").on("change",function(){if(null==$("#city").val()||""==$("#city").val()){return}$(".warn").empty();$("#frameNo").val("");$("#engineNo").val("");var g="provCode="+$("#province").val()+"&cityCode="+$("#city").val();e.queryPeccancy(ajaxUrl.queryPeccancy,g,function(h){e.genErrorHtml(h)},null)});var d=$("#errMsg").val();if(d!=""&&d!=null){e.genErrorHtml(d);$("#errMsg").val("")}else{$(".warn").empty();$(".warn").hide()}var f=$("#province").attr("attr-value");var b=$("#city").attr("attr-value");if(null!=f&&""!=f){e.getProvince(ajaxUrl.getProvince,function(g){e.genErrorHtml(g)},f,function(){if(null!=b&&""!=b){var h="provCode="+f;var g=h+"&cityCode="+b;e.getCity(ajaxUrl.getCity,function(i){e.genErrorHtml(i)},h,b,function(){e.queryPeccancy(ajaxUrl.queryPeccancy,g,function(i){e.genErrorHtml(i)},null)})}else{if(null!=f&&""!=f){var h="provCode="+f;e.getCity(ajaxUrl.getCity,function(i){e.genErrorHtml(i)},h,null,null)}}},function(){var h="provCode=SH";var g=h+"&cityCode=SH";e.getCity(ajaxUrl.getCity,function(i){e.genErrorHtml(i)},h,"SH",function(){e.queryPeccancy(ajaxUrl.queryPeccancy,g,function(i){e.genErrorHtml(i)},null)})})}else{e.getProvince(ajaxUrl.getProvince,function(g){e.genErrorHtml(g)},null,null,null)}if($.browser.msie){$(":input[placeholder]").each(function(){$(this).placeholder()})}if($.browser.msie&&($.browser.version=="7.0")){$(":input[placeholder]").each(function(){$(this).placeholder()})}},searchIllegal:function(a){$("#illegalSearchBtn").attr("disabled","disabled");var b=$("#province").val()+"|"+$("#city").val()+"|"+$("#carBelong").val()+"|"+$("#carNo").val()+"|"+$("#engineNo").val()+"|"+$("#frameNo").val();$("#illegalData").val(b);$("#illegalForm").attr("action",a);$("#illegalForm").submit();$("#illegalSearchBtn").removeAttr("disabled")},validate:function(){var p=$("#province").val();if(p==null||p==""){this.genErrorHtml("请选择省份");return false}var l=$("#city").val();if(l==null||l==""){this.genErrorHtml("请选择城市");return false}var n=$("#carBelong");var m=$("#carBelong").val();var g=n.attr("data-required");if("required"==g){if(""==m||null==m){this.genErrorHtml("请选择车牌归属地");return false}else{}}var o=$("#carNo");var d=$("#carNo").val();var j=o.attr("data-required");if("required"==j){if(""==d||null==d){this.genErrorHtml("请输入车牌号码");return false}else{if(!this.isNumAndLetter(d)){this.genErrorHtml("请输入正确的车牌号码");return false}else{if(d.length!=6){this.genErrorHtml("请输入正确的车牌号码");return false}}}}if(!this.isNumAndLetter(d)){this.genErrorHtml("请输入正确的车牌号码");return false}var c=$("#engineNo");var k=$("#engineNo").val();var e=c.attr("data-required");if("required"==e){if(""==k||null==k){this.genErrorHtml("请输入发动机号");return false}else{var i=c.attr("num");var b=k.length;if(b!=i&&i!=0){this.genErrorHtml("输入的发动机号必须为后"+i+"位");return false}else{if(i==0){if(b>20){this.genErrorHtml("请输入正确的发动机号");return false}else{}}}}}if(!this.isEngineeNo(k)){this.genErrorHtml("请输入正确的发动机号");return false}var h=$("#frameNo");var f=$("#frameNo").val();var a=h.attr("data-required");if("required"==a){if(""==f||null==f){this.genErrorHtml("请输入车架号");return false}else{var i=h.attr("num");var b=f.length;if(b!=i&&i!=0){this.genErrorHtml("输入的车架号必须为后"+i+"位");return false}else{if(i==0){if(b>17){this.genErrorHtml("请输入正确的车架号");return false}else{}}}}}if(!this.isNumAndLetter(f)){this.genErrorHtml("请输入正确的车架号");return false}return true},isNumAndLetter:function(b){var a=/^[0-9a-zA-Z]*$/g;return a.test(b)},isEngineeNo:function(b){var a=/^[0-9a-zA-Z]*-*[0-9a-zA-Z]*$/g;return a.test(b)},isChineseChar:function(c){var b=/w?[\u4E00-\u9FA5]+w?/;var a=b.test(c);return a},genErrorHtml:function(b){$(".warn").show();$(".warn").empty();var a='<font style="color:red;width:100%; height:20px; line-height:20px; text-align:center; display:block;">'+b+"</font>";$(".warn").append(a)},getProvince:function(b,e,d,a,c){$.ajax({type:"POST",url:b,dataType:"json",success:function(g){var h='<option value="">请选择省</option>';var f=true;if(g.status=="01"){var i=g.result;if(i!=null){for(index in i){if(d==i[index].provinceCode){f=false;break}}if(d==null||d==""){f=false}if(f){for(index in i){if(i[index].provinceCode=="SH"){h+='<option value="'+i[index].provinceCode+'" selected="selected">'+i[index].provinceName+"</option>"}else{h+='<option value="'+i[index].provinceCode+'">'+i[index].provinceName+"</option>"}}}else{for(index in i){if(d==i[index].provinceCode){h+='<option value="'+i[index].provinceCode+'" selected="selected">'+i[index].provinceName+"</option>"}else{h+='<option value="'+i[index].provinceCode+'">'+i[index].provinceName+"</option>"}}}}}else{e(g.error[0].message)}if(h!=""){$("#province").empty().append(h)}$("#city").empty().append('<option value="">请选择市</option>');if(f){if(c!=null){c()}}else{if(a!=null){a()}}}})},getCity:function(c,e,d,b,a){$.ajax({type:"POST",url:c,data:d,dataType:"json",success:function(f){var g='<option value="">请选择市</option>';if(f.status=="01"){var h=f.result;if(h!=null){for(index in h){if(b==h[index].cityCode){g+='<option value="'+h[index].cityCode+'" selected="selected">'+h[index].cityName+"</option>"}else{g+='<option value="'+h[index].cityCode+'">'+h[index].cityName+"</option>"}}}}else{e(f.error[0].message)}if(g!=""){$("#city").empty().append(g);if(a!=null){a()}}}})},queryPeccancy:function(a,c,b){$.ajax({type:"POST",url:a,data:c,dataType:"json",success:function(e){if(e.status=="01"){var d=e.result;if(d!=null){if(d.isEngine=="0"){$("#engineNo").removeAttr("data-required");$("#engineNo").val("");$(".engineNo").hide();$("#fadongjihao").hide()}else{if(d.isEngine=="1"){$(".engineNo").show();$("#fadongjihao").show();$("#engineNo").attr("data-required","required");$("#engineNo").attr("num",d.engineNo);if(d.engineNo!=0){$("#engineNo").attr("placeholder","请输入后"+d.engineNo+"位发动机号")}else{$("#engineNo").attr("placeholder","请输入全部发动机号")}if($.browser.msie){$(".engineNo>.test").remove();$("#engineNo").placeholder()}}else{$(".engineNo").hide();$("#fadongjihao").hide();$("#engineNo").val("")}}if(d.isFrame=="0"){$("#frameNo").removeAttr("data-required");$(".frameNo").hide();$("#chejiahao").hide();$("#frameNo").val("")}else{if(d.isFrame=="1"){$(".frameNo").show();$("#chejiahao").show();$("#frameNo").attr("data-required","required");$("#frameNo").attr("num",d.frameNo);if(d.frameNo!=0){var f="请输入后"+d.frameNo+"位车架号";$("#frameNo").attr("placeholder",f)}else{var f="请输入全部车架号";$("#frameNo").attr("placeholder",f)}if($.browser.msie){$(".frameNo>.test").remove();$("#frameNo").placeholder()}}else{$(".frameNo").hide();$("#frameNo").val("");$("#chejiahao").hide()}}}}else{b(e.error[0].message)}}})},addBlurEvent:function(c){var d=c.attr("data-required");var b=c.val();var a=c.type;if(a=="hidden"){return}if(null==d&&""==d){c.attr("style","")}else{if("required"==d){if(null==b||""==b){c.attr("style","background-color:red");this.genErrorHtml("请输入必填项")}else{c.attr("style","");$(".warn").empty();$(".warn").hide()}}}}};