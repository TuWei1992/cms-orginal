function _getCookie(b){var a=document.cookie.match(new RegExp("(^| )"+b+"=([^;]*)"));return a!=null?decodeURIComponent(a[2]):null}function _setCookie(b,d,c){if(c){var a=new Date();a.setTime(a.getTime()+c*24*3600*1000);document.cookie=b+"="+encodeURIComponent(d)+";path=/;expires="+a.toGMTString()}else{document.cookie=b+"="+encodeURIComponent(d)+";path=/"}}function cityCookie(b,a){_setCookie("MALL_CITY_ID",b,365);_setCookie("MALL_CITY_NAME",a,365)}function city(){var a=$("#currentCity"),c=$("#cityPos"),b=a.text(),d=$("#citychage");d.on("click","a",function(){var f=$(this).attr("cityid"),e=$(this).attr("name");cityCookie(f,e);window.location.href=cityLinks[f][0]})}function _arrayIsContain(b,d){var a=false;var c;$.each(b,function(e){if($.isArray(b)){c=b[e]}else{c=e}if(d===c){a=true;return false}});return a}function getCookie(){var a=$("#currentCity");var c=_getCookie("MALL_CITY_ID");var b=_getCookie("MALL_CITY_NAME");if(c&&b){if(isSiteIndex()){window.location.href=cityLinks[c][0];return}a.attr({cityid:c,name:b}).text(b)}else{a.attr({cityid:"310100",name:"上海"}).text("上海");setCityCookie()}}function setCityCookie(){if(window.location.host.indexOf("localhost")!=-1){cityCookie("310100","上海")}var a=["上海","苏州","宁波","杭州","南京","成都"],b={"上海":["上海"],"江苏":["南京"],"浙江":["杭州"],"四川":["成都"]};$.getJSON("http://api.map.baidu.com/location/ip?ak=F454f8a5efe5e577997931cc01de3974&ip=&callback=?",function(d){if(!d||d.length==0||d.status!=0){return}var e=d.address.split("|");var f=e[2],c=e[1];if(_arrayIsContain(a,f)){}else{if(_arrayIsContain(b,c)){f=b[c][0]}else{f="上海"}}$.getJSON("/common/cityid.htm?cityName="+encodeURIComponent(f),function(g){if(g){cityCookie(g.cityId,g.cityName)}})})}function getCityList(){var b=_getCookie("MALL_CITY_ID");var a=$(document.createDocumentFragment());if(!cityLinks){return false}$.each(cityLinks,function(e,f){if(e&&f[1]){var d="";if(e==b){d=' class="cur"'}var c=$('<a href="javascript:void(0);" target="_self" cityid="'+e+'" name="'+f[1]+'" class="city-name"><span'+d+">"+f[1]+"</span></a>");c.appendTo(a)}});a.appendTo($("#citychage"))}$(document.body).on("click",function(a){$("#cityPos").removeClass("city-cur");$("#citychage").hide()});$("#cityPos").on("click",function(){if($(this).hasClass("city-cur")){$(this).removeClass("city-cur");$("#citychage").slideUp();return false}$(this).addClass("city-cur");$("#citychage").slideDown();return false});function isSiteIndex(){var b=window.location.href.replace(/\/+/g,"/");var a=b.indexOf("/",b.indexOf(window.location.host));if(a==-1){return true}var c=b.lastIndexOf("/");return a==c}if(!isSiteIndex()&&typeof(pageCityID)!="undefined"&&pageCityID){cityCookie(pageCityID,pageCityName)}getCookie();city();getCityList();$(document).ready(function(){$.ajax({url:"/common/head.htm",dataType:"json",cache:false,success:function(d){if(d){var c=$("#mall-my");c.attr({href:c.attr("login-href"),target:"_blank"});$("#box01").hide().siblings("#box02").show();$("#box02").children().eq(0).html(d.greetings+'，<span title="'+d.greetings+","+d.memberCenterInfo.defaultAccount+'">'+d.realName+"</span>");var b=mainBase+"/common/account/logout.htm?backUrl="+encodeURIComponent(window.location.href);$("#userCenter .group").append("<a href='"+b+"' target='_self'>退出</a>")}else{$("#box01").show().siblings("#box02").hide()}}});$(".login-bind").on("click",function(){var b=window.location.href;window.location.href=accountBase+"/account/login.htm?backUrl="+encodeURIComponent(b);return false});$(".register-bind").on("click",function(){var b=window.location.href;window.location.href=accountBase+"/account/m_register.htm?backUrl="+encodeURIComponent(b);return false});a($("#userCenter"),$(".user-hd"),"user-cur",$(".group"));function a(c,f,e,d){var b=null;c.mouseover(function(){clearTimeout(b);f.addClass(e);d.show()}).mouseout(function(){b=setTimeout(function(){d.slideUp(200,function(){f.removeClass(e)})},500)})}});